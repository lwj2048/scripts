on:
  workflow_run:
    workflows: ["Check Keywords"]
    types:
      - completed

jobs:
  monitor_job:
    runs-on: ubuntu-latest

    steps:
    - name: Check job status
      id: job_status
      run: echo "::set-output name=job_status::${{ github.event.workflow_run.conclusion }}"
      
    - name: Checkout code
      if: steps.job_status.outputs.job_status == 'failure'
      uses: actions/checkout@v2
      with:
        fetch-depth: 0
      
    - name: Rollback on failure
      if: steps.job_status.outputs.job_status == 'failure'
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "actions@users.noreply.github.com"
        git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/lwj2048/scripts.git
        git branch
        git checkout main
        git reset --hard HEAD~1
        git push --force
